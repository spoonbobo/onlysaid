name: OnlySaid CI/CD

on:
  push:
    branches:
      - development # Assuming 'development' is your dev branch as per git status

jobs:
  test-jfrog-connection:
    name: Test JFrog Artifactory Connection
    runs-on: ubuntu-latest
    env:
      JFROG_CLI_URL: ${{ secrets.JFROG_URL }}
      JFROG_CLI_ACCESS_TOKEN: ${{ secrets.JFROG_TOKEN }}

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up JFrog CLI
        uses: jfrog/setup-jfrog-cli@v4

      - name: Ping JFrog Artifactory
        run: |
          # Verify JFrog CLI is installed and configured
          jfrog --version
          # Ping Artifactory to test the connection and credentials
          # The CLI will automatically use the JFROG_CLI_URL and JFROG_CLI_ACCESS_TOKEN env vars
          jfrog rt ping
        shell: bash

      - name: Create and Upload a Test Artifact
        run: |
          # Create a dummy file to upload
          echo "A test file from GitHub Actions" > test-file.txt
          
          # Upload the file to a 'dev' repository in Artifactory
          # This verifies write permissions to the 'onlysaid-electron-dev-local' repository
          jfrog rt u "test-file.txt" "onlysaid-electron-dev-local/test-file.txt"
        shell: bash
        
      - name: Clean Up Test Artifact
        if: always() # This step will always run, even if previous steps fail
        run: |
          # Remove the test file from Artifactory to keep the repository clean
          jfrog rt del "onlysaid-electron-dev-local/test-file.txt" --quiet
        shell: bash